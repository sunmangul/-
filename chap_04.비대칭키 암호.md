# <p align="center">🔐비대칭키 암호</p>
※ 비대칭키의 특징, RSA 알고리즘, ElGamal, 하이브리드 암호 시스템에 집중
## 🔒 비대칭키 암호
### ✅  키 배송 문제
#### 1) 개요
- 대칭키 암호는 키 배송 문제를 안고 있음
  - 키를 보내지 않으면 Bob(수신자)이 복호화를 못함
  - 키를 보내면 Eve(도청자)가 복호화 가능
- 키 배송 문제의 해결법
  - 키를 사전에 공유에 의한 해결
  - 키배포 센터에 의한 해결(온라인 키 분배)
  - Diffie-Hellman 키 교환에 의한 해결
  - 공개키 암호(비대칭키 암호)에 의한 해결
#### 2) 키의 사전 공유에 의한 해결
- 키 관리기관(TA, trusted authority)이 사전에 임의의 사용자들에게 비밀경로를 통하여 임의키를 선택 후 전달
- TA와 네트워크 상의 모든 사용자 사이에 안전한 통로 필요
- 사용자가 많은 경우에 TA는 물론 사용자들도 많은 키를 관리해야하는 문제가 있음
- 사용자 n명이 있다면 각 사용자는 n-1가지 키를 관리해야 함
- 사용자 n명이 있다면 TA는 n(n-1)/2가지 키를 관리해야함(복잡, 많은 비용)
#### 3) 키배포 센터(KDC)에 의한 해결(온라인 키 분배)
- 개요
  - 암호 통신이 필요해질 때 통신용 키를 제 3자에 의뢰해서 개인과 센터 사이에서만 키를 사전에 공유
  - TA가 네트워크 상의 모든 사용자와 필요할 때마다 키를 공유
  - 회사에 키배포 센터의 역할을 하는 컴퓨터를 지정
  - n명의 사원이 있으면 n개의 키를 컴퓨터 데이터 베이스에 저장
- 단계별 순서
  1. Alice는 키배포 센터에 "Bob과 통신하고 싶다."고 신청
  2. 키배포 센터는 의사난수 생성기를 사용하여 세션키(K)를 만듦(이번 통신만을 위한 일시적인 키)
  3. 키배포 센터는 데이터베이스에서 Alice의 키(KA)와 밥의 키(KB)를 꺼냄
  4. 키배포 센터는 Alice의 키를 사용하여 세션키를 암호화(C_{A} = E_{KA}(K))해서 Alice에게 전달
  5. 키배포 센터는 Bob의 키를 사용하여 세션키를 암호화(C_{B} = E{KB}(K))해서 Bob에세 전달
  6. 앨리스는 키배포 센터에서 온 세션키를 복호화(K = D_{KA}(C_{A}))해서 세션키를 획득
  7. Alice는 세션키를 사용하여 Bob에게 보낼 메일을 암호화(C = E_{K}(M))해서 Bob에게 전달
  8. Bob은 키배포 센터에서 온 세션키를 복호화(K = D_{KB}(C_{B}))해서 세션키를 획득
  9. Bob은 세션키를 사용하여 Alice에게 온 암호문을 복호화(M = D_{K}(C))함
  10. Alice와 Bob은 세션키를 삭제
#### 4) Diffie-Hellman 키 교환(키 합의)에 의한 해결
- 개요
  - 1976년 공개키 암호방식을 최초로 제안한 휘트필드 디피와 마틴 헬먼이 발명한 알고리즘
  - 두 사용자 간에 공통의 암호화키를 안전하게 공유할 수 있는 방법 제시
  - 많은 키 분배 방식에 관한 연구의 기본(최초의 비밀키 교환 프로토콜)
  - 양쪽 통신주체가 KDC 없이 대칭 세션키르 생성
  - 대칭키를 만들기 전에 양쪽은 두개의 수 p와 g를 선택
    - p는 300자리가 넘는 십진수(1024bit)
    - p와 g는 Eve에게 알려져도 문제 없음
  - 키 교환이라는 이름이 붙어있지만 실제로는 키를 교환하는 것이 아닌 공유할 키를 계산하여 만듦
  - 유한체상의 이산대수 문제(DLP)를 풀기 어렵다는 사실이 Diffie-Hellman 키 교환을 뒷받침 함
- 타원 곡선 Diffie-Hellman 키 교환(ECDH)
  - 이산대수 문제를 매우 풀기 어렵다는 사실ㅇ들 이용해서 키 교환을 실현
  - 이산대수 문제를 타원곡선상의 이산대수 문제로 대체한 키 교환 알고리즘도 있음
  - 키 교환 방법에 있어서 큰 흐름은 같지만, 사용되는 문제에 조금 차이가 남
  - 그냥 Diffie-Hellman 키 교환보다 짧은 키 길이로 높은 보안성
- 절차
  - Alice는 임의의 큰 수 x를 0 <= x <= p-1 안에서 선택하고 R_{1} = g^x mod p를 계산
  - Bob은 다른 임의의 큰 수 y를 0 <= y <= p-1 안에서 선택하고 R_{2} = g^y mod p를 계산
  - Alice는 R_{1}을 Bob에게 보냄(x값이 아닌 R_{1}만 전송)
  - Bob은 R_{2}을 Alice에게 보냄(역시나 y값이 아닌 R_{2}만 전송)
  - Alice는 K = (R_{2})^x mod p를 계산
  - Bob은 K = (R_{1})^y mod p를 계산
  - 이렇게 구한 값 K는 아래와 같고 세션에 사용되는 대칭키임
```
K = (g^x mod p)^y mod p = (g^y mod p)^x mod p = g^xy mod p
```
▶ 모률러 연산의 성질

    - 성질 1 : (a + b) mod n = ((a mod n) + (b mod n)) mod n
    - 성질 2 : (a - b) mod n = ((a mod n) - (b mod n)) mod n
    - 성질 3 : (a * b) mod n = ((a mod n) * (b mod n)) mod n

- Diffie-Hellman
  - 이산대수 공격
    - 키 교환의 안전성이 이산대수 문제가 풀기 어렵다는 곳에 기반
    - Eve가 R_{1}과 R_{2}를 가로챌 수 있음
    - Eve가 R_{1} = g^x mod p에서 x를 구하고 R_{2} = g^y mod p에서 y를 구할 수 있음
    - 위와 같은 상황에서 비밀키가 더 이상 비밀이 되지 못함
  - 서비스 거부 공격(DoS, Denial of Service)
    - DH 기법은 지수 함수에 기초해서 계산 복잡
    - 많은 수의 장치와 동시 통신을 하면 비밀키 생성에 큰 지연 시간이 발생
    - 위와 같은 문제로 제 3자에 의한 DoS공격에 취약
    - 공격 할 서버에 IP 스푸핑을 통해 위조한 키 생성을 요청을 다수가 동시에 함으로 키 생성에 부담
    - 서버 마비
  - 중간자 공격(man-in-the-middle attack), 양동이 소방대 공격(bucket brigade)
    - 키 교환 프로토콜은 인증단계가 없어서 중간자 공격같은 공격에 취약
    - 전자서명과 공개키 인증서 등을 이용하여 방어
    - 불을 끄려고 한 줄로 늘어선 자원 봉사자들이 물이 든 양동이를 옆사람에게 전달하는 것 처럼 보임
    - 이 때문에 Diffie-Hellman에 기반을 둔 방법에서는 인증사용
 
▶ 국-대-국 키 합의

국-대-국 프로토콜(STS, Station-To_Station protocol)은 Diffie-Hellman에 기반을 둔 방법<br/>
여기서는 Alice와 Bob 사이의 세션키를 만들기 위해 공개키 인증서를 이용한 전자서명을 사용(중간자 공격 방어)

#### 5) 공개키 암호에 의한 해결
- 대칭키 암호에서 암복호화에 사용되는 키가 서로 같지만, 공개키에서는 암복호화에 사용되는 키가 다름
- 수신자는 미리 암호화키(공개키)를 송신자에게 알려줌(도청자에 알려져도 상관 없음)
- 복호화가 가능한건 복호화키(비밀키)를 가진 수신자만 가능(복호화키를 수신자에게 배송할 필요가 없음)

### 공개키 암호
#### 1) 개요
- 평문을 복잡한 형태로 변환해서 기밀성을 유지
  - 공개키 암호는 수학적으로 해결하기 곤란한 문제를 토대로 해서 기밀성 유지
- 공개키 암호에서는 암호화키와 복호화키가 분리
  - 송신자는 암호화키를 사용하여 메시지를 암호화
  - 수신자는 복호화키를 사용하여 암호문을 복호화
- 키쌍을 이루는 2개의 키는 서로 수학적으로 밀접한 관계를 가짐(공개키와 개인키를 각각 만들 수 없음)

#### 2) 공개키 암호의 역사
- 1976년 휘트필드 디피(Whifield **Diffie**)와 마틴 헬만(Martin **Hellman**)이 공개키 암호의 아이디어 발표
- 구체적이진 않지만 암호화키와 복호화키를 나누는 것과 공개키가 어떤 특성을 가져야 하는지 제시
- 1978년 Ron Rivest, Adi shamir, Leonard Adleman이 공개키 알고리즘과 RSA발표(사실상 표준)

▶ 공개키 암호알고리즘 → 소인수분해 문제 → Rabin<br/>
ㅤㅤㅤㅤㅤㅤ↓ㅤㅤㅤㅤㅤㅤㅤㅤㅤ↓<br/>
ㅤㅤㅤ이산대수 문제ㅤㅤㅤㅤㅤ RSA<br/>
ㅤㅤ↓ㅤㅤ ㅤ ↓ㅤㅤㅤㅤㅤ↓<br/>
ElGamalㅤㅤDSAㅤㅤECC(타원곡선)

#### 3) 공개키 암호의 중간자 공격(man-in-the-middle attack)
- 기밀성에 대해 매우 유효한 공격 방법
- 맬로리(적극적 공격자)가 송수신자 사이에서 송신자에게는 수신자처럼 수신자에게는 송신자처럼 행세
- 중간자는 사이에 있는 사람이라는 의미
- 중간자 공격은 RSA뿐 아니라 어떤 공개키 암호에도 사용할 수 있음
- 중간자 공격을 막기 위해서 공개키가 진짜 Bob의 것인지 확인하는 수단인 공개키 인증서를 사용

#### 4) 대칭키 vs 비대칭키
- 비대칭키가 등장해도 대칭키가 의외로 잘 쓰임
  - 1. 비대칭키 암호시스템이 암복호화에 수학적인 함수를 사용해서 대칭키 암호시스템보다 무척 느림
  - 2. 메시지 크기가 매우 큰 경우 대칭키 암호시스템이 중요한 요인
- 대칭키 암호시스템의 처리 속도가 빠르다고 해서 비대칭키 암호시스템의 열할을 대신할 수도 없음
- 비대칭키 암호시스템은 인증이나 전자서며오가 대칭키 교환에 유용하게 사용됨
- 
